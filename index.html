<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>











<head>
<title>FreeIPA Identity Management planet - technical blogs</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="Planet/2.0 +http://www.planetplanet.org">
<link rel="stylesheet" href="planet.css" type="text/css">
<link rel="alternate" href="http://planet.freeipa.org/atom.xml" title="" type="application/atom+xml">
</head>

<body>
<h1><a href="http://www.freeipa.org/"><img src="images/logo.png" width="220" height="68" alt=""></a>FreeIPA Identity Management planet - technical blogs</h1>

<div class="daygroup">
<h2>January 22, 2023</h2>

<div class="channelgroup">







<h3><a href="https://frasertweedale.github.io/blog-redhat" title="Fraser's IdM Blog">Fraser Tweedale</a></h3>


<div class="entrygroup" id="https://frasertweedale.github.io/blog-redhat/posts/2023-01-22-openshift-feature-gates.html">
<h4><a href="https://frasertweedale.github.io/blog-redhat/posts/2023-01-22-openshift-feature-gates.html">Enabling Kubernetes feature gates in OpenShift</a></h4>
<div class="entry">
<div class="content">
<h1 id="enabling-kubernetes-feature-gates-in-openshift">Enabling Kubernetes feature gates in OpenShift</h1>
<p>When Kubernetes adds a feature or changes an existing one, the new
behaviour usually starts out hidden behind a <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/"><em>feature
gate</em></a>. Enhancements start off in the <em>Alpha</em>
stability class, where they are usually guarded by a feature gate
that is <strong>off by default</strong>. If the enhancement proves stable and
useful, after a few releases it will be promoted to <em>Beta</em>, and the
feature gate will typically default to <strong>on</strong>, though it can still
be disabled. The final stage of an enhancement is <em>GA (generally
available)</em>. If an enhancement reaches this stage, its feature gate
becomes non-operational and is <a href="https://kubernetes.io/docs/reference/using-api/deprecation-policy/">deprecated</a>, to be removed in a
later release.</p>
<p>So, in a real world deployment how do you enable or disable a
feature gate? There are several “distributions” of Kubernetes and
various ways of doing it. In this short post I’ll demonstrate how
to enable feature gates in <em>OpenShift</em>, Red Hat’s container
orchestration platform which is built on Kubernetes.</p>
<h2 id="the-featuregate-resource">The <code>FeatureGate</code> resource <a href="https://frasertweedale.github.io/blog-redhat/atom.xml#the-featuregate-resource" class="section">§</a></h2>
<p>OpenShift recognises a <code>FeatureGate</code> resource type. A single,
resource of this type named <code>cluster</code> determines the feature gates
used across the cluster. A cluster administrator can modify
<code>FeatureGate/cluster</code> to vary the feature gates set in the cluster
from the defaults.</p>
<p>The <code>FeatureGate</code> resource is more than a mere list of feature gates
to enable or disable. First, in addition to Kubernetes feature
gates, it can also set feature gates for features in OpenShift
itself, or other components or products in the cluster. Second, it
can refer to named <em>feature sets</em>—groups of feature gates—as an
alternative to explicitly listing all the feature gates to enable or
disable.</p>
<p>For example, the <code>TechPreviewNoUpgrade</code> feature set enables a
collection of features that Red Hat have marked as useful and worthy
of customer <em>testing</em>, with a view to possible promotion to full
support in a future release. Customers do not need to enable
individual feature gates but can instead enable all the <em>Technology
Preview</em> features via the following <code>FeatureGate</code> spec:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb1-1" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> config.openshift.io/v1</span></span>
<span id="cb1-2"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb1-2" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> FeatureGate</span></span>
<span id="cb1-3"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb1-3" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb1-4" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cluster</span></span>
<span id="cb1-5"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb1-5" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb1-6"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb1-6" tabindex="-1"></a><span class="at">  </span><span class="fu">featureSet</span><span class="kw">:</span><span class="at"> TechPreviewNoUpgrade</span></span></code></pre></div>
<div class="note">
<p>Unlike the more general <code>MachineConfig</code> objects, <code>FeatureGate</code>
objects do not get composed together. Only the single object name
<code>cluster</code> is recognised. So there is no “lightweight” way to enable
all the feature gates from <code>TechPreviewNoUpgrade</code> plus one or two
additional feature gates. To accomplish that, use a
<code>CustomNoUpgrade</code> with <strong>all</strong> the desired feature gates listed.</p>
</div>
<h2 id="enabling-specific-feature-gates">Enabling specific feature gates <a href="https://frasertweedale.github.io/blog-redhat/atom.xml#enabling-specific-feature-gates" class="section">§</a></h2>
<p>What if the <code>TechPreviewNoUpgrade</code> feature set does not include the
feature gate you want to enable? The <code>CustomNoUpgrade</code> feature set
allows you to list the specific feature gates you want to enable or
disable. The following exmaple enables the
<code>UserNamespaceStatelessPodsSupport</code> feature gate:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb2-1" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> config.openshift.io/v1</span></span>
<span id="cb2-2"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb2-2" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> FeatureGate</span></span>
<span id="cb2-3"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb2-3" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb2-4"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb2-4" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cluster</span></span>
<span id="cb2-5"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb2-5" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb2-6"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb2-6" tabindex="-1"></a><span class="at">  </span><span class="fu">featureSet</span><span class="kw">:</span><span class="at"> CustomNoUpgrade</span></span>
<span id="cb2-7"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb2-7" tabindex="-1"></a><span class="at">  </span><span class="fu">customNoUpgrade</span><span class="kw">:</span></span>
<span id="cb2-8"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb2-8" tabindex="-1"></a><span class="at">    </span><span class="fu">enabled</span><span class="kw">:</span></span>
<span id="cb2-9"><a href="https://frasertweedale.github.io/blog-redhat/atom.xml#cb2-9" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> UserNamespacesStatelessPodsSupport</span></span></code></pre></div>
<h2 id="applying-featuregate-changes">Applying <code>FeatureGate</code> changes <a href="https://frasertweedale.github.io/blog-redhat/atom.xml#applying-featuregate-changes" class="section">§</a></h2>
<p>When you change <code>FeatureGate/cluster</code>, new <code>MachineConfig</code> objects
get generated containing updated configurations of the relevant
Kubernetes and OpenShift components (e.g. <em>kubelet</em>). Machine
Config Operator will progressively update and restart the nodes in
the cluster, while ensuring availability.</p>
<p>Let’s see an example. First, observe that all <code>MachineConfigPool</code>s
are up to date (<code>ready</code> count = machine <code>count</code>):</p>
<pre class="shell"><code>% oc get MachineConfigPool -o json | jq --compact-output \
    '.items[] | { name: .metadata.name \
                , count: .status.machineCount \
                , ready: .status.readyMachineCount}'
{&quot;name&quot;:&quot;master&quot;,&quot;count&quot;:3,&quot;ready&quot;:3}
{&quot;name&quot;:&quot;worker&quot;,&quot;count&quot;:3,&quot;ready&quot;:3}</code></pre>
<p>Also observe that the <code>FeatureGate/cluster</code> object does exist, but
its spec is empty (so the default feature gate settings are used):</p>
<pre class="shell"><code>% oc get -o json FeatureGate/cluster | jq .spec
{}</code></pre>
<p>Now update the <code>FeatureGate/cluster</code> object. Assume the
<code>CustomNoUpgrade</code> configuration shown earlier resides in a file
named <code>featuregate-userns.yaml</code>.</p>
<pre class="shell"><code>% oc replace -f featuregate-userns.yaml
featuregate.config.openshift.io/cluster replaced</code></pre>
<p>After a few moments, Machine Config Operator will observe the new
configuration and start updating and restarting the nodes.
Initially, all pools have zero machines in state <code>ready</code> (because
they all need updating):</p>
<pre class="shell"><code>% oc get MachineConfigPool -o json | jq --compact-output \
    '.items[] | { name: .metadata.name \
                , count: .status.machineCount \
                , ready: .status.readyMachineCount}'
{&quot;name&quot;:&quot;master&quot;,&quot;count&quot;:3,&quot;ready&quot;:0}
{&quot;name&quot;:&quot;worker&quot;,&quot;count&quot;:3,&quot;ready&quot;:0}</code></pre>
<p>After some period of time (which will vary by cluster size), all the
nodes will have received the updated configuration and restarted.</p>
<p>As for verifying that the updates were applied correctly, that will
depend on which gates are being enabled or disabled. It is out of
scope for this article. But in terms of <em>how</em> to set feature flags
in OpenShift, I hope that this article has conveyed it clearly and
that it will be useful to others.</p>
<p>For further detail, see the official OpenShift <a href="https://docs.openshift.com/container-platform/4.12/nodes/clusters/nodes-cluster-enabling-features.html"><code>FeatureGate</code>
documentation</a> and <a href="https://docs.openshift.com/container-platform/4.12/rest_api/config_apis/featuregate-config-openshift-io-v1.html"><code>FeatureGate</code> object
schema</a>.</p></div>







<p class="date">
<a href="https://frasertweedale.github.io/blog-redhat/posts/2023-01-22-openshift-feature-gates.html">January 22, 2023 12:00 AM</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>January 13, 2023</h2>

<div class="channelgroup">







<h3><a href="https://rcritten.wordpress.com" title="Frustrations">Rob Crittenden</a></h3>


<div class="entrygroup" id="http://rcritten.wordpress.com/?p=372" lang="en">
<h4><a href="">Authentication for the pki command</a></h4>
<div class="entry">
<div class="content">
The dogtag PKI CA provides its own command-line tools for reading and writing configuration. Some of these require authentication in order to work. On the CA machine as root you have access to the NSS certificate database so can use the subsystem certificate for authentication, like: # pki -d /etc/pki/pki-tomcat/alias -n 'subsystemCert cert-pki-ca' -f /etc/pki/pki-tomcat/password.conf &#8230; <a href="https://rcritten.wordpress.com/2023/01/13/authentication-for-the-pki-command/" class="more-link">Continue reading <span class="screen-reader-text">Authentication for the pki command</span> <span class="meta-nav">&#8594;</span></a></div>







<p class="date">
<a href="">by rcritten at January 13, 2023 04:41 PM</a>
</p>
</div>
</div>


</div>

</div>


<div class="sidebar">

<h2>Subscriptions</h2>
<ul>
<li>
<a href="http://adam.younglogic.com/category/software/freeipa,kerberos,ldap/feed/" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="http://adam.younglogic.com" title="">
Adam Young	</a>
</li>
<li>
<a href="https://vda.li/en/freeipa.xml" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<span class="message" title="internal server error">
Alexander Bokovoy	</span>
</li>
<li>
<a href="https://floblanc.wordpress.com/tag/freeipa/feed/" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://floblanc.wordpress.com" title="">
Florence Blanc-Renaud	</a>
</li>
<li>
<a href="https://frasertweedale.github.io/blog-redhat/atom.xml" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://frasertweedale.github.io/blog-redhat" title="">
Fraser Tweedale	</a>
</li>
<li>
<a href="https://jhrozek.wordpress.com/tag/freeipa,sssd,ldap,idm/feed/" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://jhrozek.wordpress.com" title="">
Jakub Hrozek	</a>
</li>
<li>
<a href="http://justin-stephenson.blogspot.com/feeds/posts/default?alt=rss" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="http://justin-stephenson.blogspot.com/" title="">
Justin Stephenson	</a>
</li>
<li>
<a href="https://blog.delouw.ch/tag/ipa/feed/" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<span class="message" title="internal server error">
Luc de Louw	</span>
</li>
<li>
<a href="https://npmccallum.gitlab.io/index.xml" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://npmccallum.gitlab.io/" title="">
Nathaniel McCallum	</a>
</li>
<li>
<a href="https://preichl.wordpress.com/tag/sssd/feed/" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://preichl.wordpress.com" title="">
Pavel Reichl	</a>
</li>
<li>
<a href="http://rhelblog.redhat.com/tag/identity-management,idm/feed/" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://www.redhat.com/en/blog/channel/red-hat-enterprise-linux" title="">
Red Hat Blog	</a>
</li>
<li>
<a href="https://richmegginson.livejournal.com/data/rss/" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://richmegginson.livejournal.com/" title="">
Rich Megginson	</a>
</li>
<li>
<a href="https://rcritten.wordpress.com/feed/" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://rcritten.wordpress.com" title="">
Rob Crittenden	</a>
</li>
<li>
<a href="https://ssimo.org/blog/blog.atom" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://ssimo.org/blog/" title="">
Simo Sorce	</a>
</li>
<li>
<a href="https://strikerttd.wordpress.com/tag/freeipa,sssd,ldap,idm/feed/" title="subscribe"><img src="images/feed-icon-10x10.png" alt="(feed)"></a>

	<a href="https://strikerttd.wordpress.com" title="">
Striker Leggette	</a>
</li>
</ul>

<h2>Last updated</h2>
<p>
January 28, 2023 05:13 AM<br>
<em>All times are UTC.</em><br>
</p>

<h2>Meta</h2>

<ul>
<li><a href="rss20.xml" title="RSS 2.0 feed"><img src="images/feed-icon-10x10.png" alt="(feed)"> RSS 2.0</a></li>
<li><a href="atom.xml" title="Atom feed"><img src="images/feed-icon-10x10.png" alt="(feed)"> Atom</a></li>
</ul>

<h2>Related</h2>

<ul>
<li><a href="http://www.freeipa.org/">FreeIPA project</a></li>
<li><a href="http://www.fedoraproject.org/">Fedora project</a></li>
<li><a href="http://planet.fedoraproject.org/">Fedora planet</a></li>
</ul>

<h2>Hosting</h2>

<p>
<a href="https://www.openshift.com/" title="Powered by OpenShift Online">
  <img alt="Powered by OpenShift Online" src="https://www.openshift.com/images/logos/powered_by_openshift.png">
</a>
</p>
</div>

<div>
	<a href="http://www.planetplanet.org/"><img src="images/planet.png" width="80" height="15" title="Powered by Planet" alt="Powered by Planet" border="0"></a>
</div>

</body>

</html>
